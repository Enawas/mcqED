<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertisseur TXT vers JSON - mcqED</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="dark-mode.css">
    <script src="theme-init.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: #f8f9fa;
            color: #374151;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            background: #f1f3f4;
        }
        
        .sidebar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea !important;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .sidebar-brand:hover {
            color: #667eea !important;
            text-decoration: none;
        }
        
        .sidebar-user {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            background: #f1f3f4;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .user-info i {
            font-size: 1.2rem;
            color: #667eea;
        }
        
        .sidebar-nav {
            padding: 1rem 0;
        }
        
        .nav-section {
            margin-bottom: 2rem;
        }
        
        .nav-section-title {
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .nav-item {
            margin: 0;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: #6b7280;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-link:hover {
            background: #f3f4f6;
            color: #374151;
            text-decoration: none;
            border-left-color: #667eea;
        }
        
        .nav-item.active .nav-link {
            background: #667eea;
            color: #ffffff;
            border-left-color: #ffffff;
        }
        
        /* Style spécial pour le bouton Favoris quand il est actif */
        .nav-item.active .nav-link[onclick*="toggleFavoritesView"] {
            background: #dc2626 !important;
            color: #ffffff !important;
            border-left-color: #ffffff !important;
        }
        
        .nav-item.active .nav-link[onclick*="toggleFavoritesView"] i {
            color: #ffffff !important;
        }
        
        .nav-link i {
            width: 20px;
            text-align: center;
            font-size: 1rem;
        }
        
        .nav-link span {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .nav-link.text-danger {
            color: #dc2626 !important;
        }
        
        .nav-link.text-danger:hover {
            background: #fef2f2;
            color: #dc2626 !important;
        }
        
        /* Mode sombre pour la sidebar */
        [data-theme="dark"] .sidebar {
            background: #1a1a1a;
            color: #ffffff;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
        }
        
        [data-theme="dark"] .sidebar-header {
            border-bottom: 1px solid #333;
            background: #111;
        }
        
        [data-theme="dark"] .sidebar-user {
            border-bottom: 1px solid #333;
            background: #222;
        }
        
        [data-theme="dark"] .user-info {
            color: #ccc;
        }
        
        [data-theme="dark"] .nav-section-title {
            color: #888;
        }
        
        [data-theme="dark"] .nav-link {
            color: #ccc;
        }
        
        [data-theme="dark"] .nav-link:hover {
            background: #333;
            color: #ffffff;
        }
        
        [data-theme="dark"] .nav-link.text-danger {
            color: #ff6b6b !important;
        }
        
        [data-theme="dark"] .nav-link.text-danger:hover {
            background: #4a1a1a;
            color: #ff6b6b !important;
        }
        
        /* Styles pour le sous-menu Mon compte */
        .nav-item.has-submenu {
            position: relative;
        }
        
        .nav-item.has-submenu .nav-link {
            cursor: pointer;
        }
        
        .nav-item.has-submenu .nav-link::after {
            content: '\f107';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-left: auto;
            transition: transform 0.2s ease;
        }
        
        .nav-item.has-submenu.open .nav-link::after {
            transform: rotate(180deg);
        }
        
        .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            background: #f8f9fa;
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease;
        }
        
        .nav-item.has-submenu.open .submenu {
            max-height: 200px;
        }
        
        .submenu .nav-link {
            padding-left: 3rem;
            font-size: 0.85rem;
            border-left: none;
        }
        
        .submenu .nav-link:hover {
            background: #e9ecef;
            border-left: none;
        }
        
        /* Supprimer l'icône flèche des éléments du sous-menu */
        .submenu .nav-link::after {
            display: none !important;
        }
        
        /* Mode sombre pour le sous-menu */
        [data-theme="dark"] .submenu {
            background: #1a1a1a;
        }
        
        [data-theme="dark"] .submenu .nav-link:hover {
            background: #333;
        }
        
        /* Mode daltonien */
        [data-colorblind="enabled"] {
            filter: grayscale(100%) contrast(120%);
        }
        
        [data-colorblind="enabled"] .btn-primary,
        [data-colorblind="enabled"] .btn-success,
        [data-colorblind="enabled"] .btn-danger,
        [data-colorblind="enabled"] .btn-warning,
        [data-colorblind="enabled"] .btn-info {
            filter: grayscale(0%) contrast(150%);
        }
        
        [data-colorblind="enabled"] .nav-item.active .nav-link {
            background: #000000 !important;
            color: #ffffff !important;
        }
        
        .converter-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin: 20px auto;
            max-width: 1200px;
            margin-left: 300px;
            margin-top: 20px;
        }
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-area:hover {
            border-color: #764ba2;
            background: #e9ecef;
        }
        .upload-area.dragover {
            border-color: #28a745;
            background: #d4edda;
        }
        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
        }
        .config-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
        .stats-section {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #bbdefb;
        }
        .json-preview {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
        .btn-convert {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-convert:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        .btn-download {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
            color: white;
        }
        .btn-import {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-import:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
            color: white;
        }
        .btn-reset {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
            color: white;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 10px;
            padding: 15px 20px;
            color: white;
            font-weight: 600;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        .notification.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        .notification.error {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }
        .notification.warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }
        .file-info {
            background: #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        .conversion-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* Styles pour les onglets */
        .input-tabs {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-tabs {
            border-bottom: 2px solid #e9ecef;
        }
        
        .nav-tabs .nav-link {
            border: none;
            border-radius: 10px 10px 0 0;
            color: #6c757d;
            font-weight: 600;
            padding: 12px 20px;
            margin-right: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover {
            background: #f8f9fa;
            color: #667eea;
        }
        
        .nav-tabs .nav-link.active {
            background: #667eea;
            color: white;
            border: none;
        }
        
        .text-input-area {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        
        .text-input-area textarea {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }
        
        .text-input-area textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .validation-status {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .validation-info {
            margin: 15px 0;
        }
        
        .validation-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 14px;
        }
        
        .validation-item i {
            margin-right: 10px;
            font-size: 16px;
        }
        
        .validation-summary {
            background: #c3e6cb;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .validation-summary p {
            margin: 0;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <a class="sidebar-brand" href="#">
                <i class="fas fa-graduation-cap"></i> mcqED
            </a>
        </div>
        
        <div class="sidebar-user">
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span id="username-display">Utilisateur</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="favorites.html" class="nav-link">
                        <i class="fas fa-heart"></i>
                        <span>Favoris</span>
                    </a>
                </li>
            </ul>
            
            <div class="nav-section">
                <div class="nav-section-title">Outils</div>
                <ul class="nav-list">
                    <li class="nav-item active">
                        <a href="import.html" class="nav-link">
                            <i class="fas fa-upload"></i>
                            <span>Importer</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="question-editor.html" class="nav-link">
                            <i class="fas fa-edit"></i>
                            <span>Éditeur</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Système</div>
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="password-generator.html" class="nav-link">
                            <i class="fas fa-key"></i>
                            <span>Générateur</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="diagnostic-login.html" class="nav-link">
                            <i class="fas fa-stethoscope"></i>
                            <span>Diagnostic</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="debug-login.html" class="nav-link">
                            <i class="fas fa-bug"></i>
                            <span>Debug</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Apparence</div>
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="toggleDarkMode()">
                            <i class="fas fa-moon"></i>
                            <span>Mode sombre</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="toggleColorblindMode()">
                            <i class="fas fa-eye"></i>
                            <span>Mode daltonien</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="nav-section" style="margin-top: auto;">
                <ul class="nav-list">
                    <li class="nav-item has-submenu">
                        <a href="#" class="nav-link" onclick="toggleSubmenu(this)">
                            <i class="fas fa-user"></i>
                            <span>Mon compte</span>
                        </a>
                        <ul class="submenu">
                            <li class="nav-item">
                                <a href="admin-profile.html" class="nav-link">
                                    <i class="fas fa-user-shield"></i>
                                    <span>Profil administrateur</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link text-danger" onclick="logout()">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Déconnexion</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </div>

    <div class="converter-container">
            <div class="text-center mb-4">
                <h1><i class="fas fa-file-alt text-primary"></i> Convertisseur TXT vers JSON</h1>
                <p class="text-muted">Convertissez vos fichiers texte de QCM au format JSON compatible avec mcqED</p>
            </div>

            <!-- Onglets pour choisir le mode d'entrée -->
            <div class="input-tabs mb-4">
                <ul class="nav nav-tabs" id="inputTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="file-tab" data-toggle="tab" href="#file-input" role="tab">
                            <i class="fas fa-file-upload"></i> Importer un fichier
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="text-tab" data-toggle="tab" href="#text-input" role="tab">
                            <i class="fas fa-keyboard"></i> Saisir directement
                        </a>
                    </li>
                </ul>
                
                <div class="tab-content" id="inputTabContent">
                    <!-- Onglet Import de fichier -->
                    <div class="tab-pane fade show active" id="file-input" role="tabpanel">
                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('txtFile').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h4>Glissez-déposez votre fichier TXT ici</h4>
                            <p class="text-muted">ou cliquez pour sélectionner un fichier</p>
                            <small class="text-muted">Format supporté : .txt</small>
                        </div>
                        <input type="file" id="txtFile" accept=".txt" style="display: none;" onchange="handleFileSelect(event)">
                    </div>
                    
                    <!-- Onglet Saisie directe -->
                    <div class="tab-pane fade" id="text-input" role="tabpanel">
                        <div class="text-input-area">
                            <h4><i class="fas fa-keyboard"></i> Saisissez votre texte directement</h4>
                            <p class="text-muted mb-3">Collez ou saisissez votre texte au format TXT dans la zone ci-dessous</p>
                            <textarea 
                                id="directTextInput" 
                                class="form-control" 
                                rows="15" 
                                placeholder="Page: 1&#10;Question: 1&#10;Votre question ici ?&#10;A. Première option&#10;B. Deuxième option&#10;C. Troisième option&#10;D. Quatrième option&#10;CorrectAnswers: A&#10;Explanation: Explication optionnelle&#10;&#10;Question: 2&#10;Autre question ?&#10;A. Option A&#10;B. Option B&#10;C. Option C&#10;D. Option D&#10;CorrectAnswers: B,C&#10;Explanation: Explication pour choix multiples"
                            ></textarea>
                            <div class="text-center mt-3">
                                <button class="btn btn-primary" onclick="handleDirectText()">
                                    <i class="fas fa-check"></i> Valider le texte
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Informations sur le fichier -->
            <div id="fileInfo" style="display: none;" class="file-info">
                <h5><i class="fas fa-file-alt"></i> Fichier sélectionné</h5>
                <p id="fileName" class="mb-1"></p>
                <p id="fileSize" class="mb-0 text-muted"></p>
            </div>

            <!-- Statut de validation -->
            <div id="validationStatus" style="display: none;" class="validation-status">
                <h5><i class="fas fa-check-circle text-success"></i> Statut de validation</h5>
                <div class="validation-info">
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Format du texte validé</span>
                    </div>
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Structure des questions détectée</span>
                    </div>
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Options de réponse identifiées</span>
                    </div>
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Réponses correctes trouvées</span>
                    </div>
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Prêt pour la conversion</span>
                    </div>
                </div>
                <div class="validation-summary">
                    <p class="text-success"><strong>Tout est OK !</strong> Votre texte est prêt à être converti en JSON.</p>
                    <p class="text-info mt-2 mb-0"><strong>Détection :</strong> 0 page et 0 question détectées.</p>
                </div>
            </div>

            <!-- Configuration du QCM -->
            <div class="config-section" id="configSection" style="display: none;">
                <h4><i class="fas fa-cog"></i> Configuration du QCM</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="qcmTitle">Titre du QCM *</label>
                            <input type="text" class="form-control" id="qcmTitle" placeholder="Ex: QCM VMware vSphere" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="qcmDescription">Description</label>
                            <input type="text" class="form-control" id="qcmDescription" placeholder="Description du QCM">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="qcmIcon">Icône</label>
                            <select class="form-control" id="qcmIcon">
                                <option value="fas fa-question">Question</option>
                                <option value="fas fa-server">Serveur</option>
                                <option value="fas fa-network-wired">Réseau</option>
                                <option value="fas fa-shield-alt">Sécurité</option>
                                <option value="fas fa-code">Programmation</option>
                                <option value="fas fa-database">Base de données</option>
                                <option value="fas fa-cloud">Cloud</option>
                                <option value="fas fa-laptop">Ordinateur</option>
                                <option value="fas fa-mobile-alt">Mobile</option>
                                <option value="fas fa-cogs">Configuration</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="qcmDifficulty">Niveau de difficulté</label>
                            <select class="form-control" id="qcmDifficulty">
                                <option value="beginner">Débutant</option>
                                <option value="intermediate">Intermédiaire</option>
                                <option value="advanced">Avancé</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="qcmPassingThreshold">Seuil de réussite (%)</label>
                            <input type="number" class="form-control" id="qcmPassingThreshold" min="0" max="100" value="70">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistiques de conversion -->
            <div class="stats-section" id="statsSection" style="display: none;">
                <h4><i class="fas fa-chart-bar"></i> Statistiques de conversion</h4>
                <div class="conversion-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPages">0</div>
                        <div class="stat-label">Pages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">Questions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalOptions">0</div>
                        <div class="stat-label">Options</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="conversionTime">0s</div>
                        <div class="stat-label">Temps de conversion</div>
                    </div>
                </div>
            </div>

            <!-- Aperçu JSON -->
            <div id="jsonPreview" style="display: none;">
                <h4><i class="fas fa-code"></i> Aperçu JSON</h4>
                <div class="json-preview">
                    <pre id="jsonOutput"></pre>
                </div>
            </div>

            <!-- Boutons d'action -->
            <div class="text-center mt-4" id="actionButtons" style="display: none;">
                <button class="btn btn-convert mr-2" onclick="convertToJSON()">
                    <i class="fas fa-magic"></i> Convertir en JSON
                </button>
                <button class="btn btn-download mr-2" onclick="downloadJSON()" id="downloadBtn" style="display: none;">
                    <i class="fas fa-download"></i> Télécharger JSON
                </button>
                <button class="btn btn-import mr-2" onclick="importToMCQED()" id="importBtn" style="display: none;">
                    <i class="fas fa-upload"></i> Importer dans mcqED
                </button>
                <button class="btn btn-reset" onclick="resetConverter()">
                    <i class="fas fa-redo"></i> Recommencer
                </button>
            </div>

            <!-- Instructions -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6><i class="fas fa-info-circle"></i> Instructions</h6>
                </div>
                <div class="card-body">
                    <ol class="small">
                        <li>Choisissez votre mode d'entrée :
                            <ul>
                                <li><strong>Importer un fichier :</strong> Glissez-déposez ou sélectionnez un fichier TXT</li>
                                <li><strong>Saisir directement :</strong> Collez ou saisissez votre texte dans la zone de texte</li>
                            </ul>
                        </li>
                        <li>Configurez le titre et la description</li>
                        <li>Cliquez sur "Convertir en JSON"</li>
                        <li>Téléchargez ou importez directement</li>
                    </ol>
                    <div class="alert alert-info small">
                        <strong>Format TXT attendu :</strong><br>
                        Page: 1<br>
                        Question: 1<br>
                        Votre question ici ?<br>
                        A. Première option<br>
                        B. Deuxième option<br>
                        C. Troisième option<br>
                        D. Quatrième option<br>
                        CorrectAnswers: A<br>
                        Explanation: Explication optionnelle<br>
                        <br>
                        Question: 2<br>
                        Autre question ?<br>
                        A. Option A<br>
                        B. Option B<br>
                        C. Option C<br>
                        D. Option D<br>
                        CorrectAnswers: B,C<br>
                        Explanation: Explication pour choix multiples
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="config.js"></script>
    <script>
        let convertedData = null;
        let originalText = '';

        // Gestion du thème sombre
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const icon = document.querySelector('.btn-outline-primary i');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Initialisation du thème
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            const icon = document.querySelector('.btn-outline-primary i');
            icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Gestion du drag & drop
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        // Gestion de la sélection de fichier
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        // Traitement du fichier
        function handleFile(file) {
            if (!file.name.toLowerCase().endsWith('.txt')) {
                showNotification('Veuillez sélectionner un fichier TXT valide.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                originalText = e.target.result;
                displayFileInfo(file);
                validateText();
                showConfigSection();
                showActionButtons();
            };
            reader.readAsText(file);
        }

        // Affichage des informations du fichier
        function displayFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            
            fileName.textContent = file.name;
            fileSize.textContent = `Taille: ${(file.size / 1024).toFixed(2)} KB`;
            fileInfo.style.display = 'block';
        }

        // Gestion de la saisie directe de texte
        function handleDirectText() {
            const textInput = document.getElementById('directTextInput');
            const text = textInput.value.trim();
            
            if (!text) {
                showNotification('Veuillez saisir du texte dans la zone de saisie.', 'error');
                return;
            }
            
            originalText = text;
            displayDirectTextInfo();
            validateText();
            showConfigSection();
            showActionButtons();
            showNotification('Texte validé avec succès !', 'success');
        }

        // Affichage des informations pour la saisie directe
        function displayDirectTextInfo() {
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            
            fileName.textContent = 'Texte saisi directement';
            fileSize.textContent = `Taille: ${(originalText.length / 1024).toFixed(2)} KB`;
            fileInfo.style.display = 'block';
        }

        // Validation du texte
        function validateText() {
            const lines = originalText.split('\n').map(line => line.trim()).filter(line => line);
            let hasPages = false;
            let hasQuestions = false;
            let hasOptions = false;
            let hasCorrectAnswers = false;
            let validationErrors = [];
            let pageCount = 0;
            let questionCount = 0;

            // Vérification de la structure
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                if (line.startsWith('Page:')) {
                    hasPages = true;
                    pageCount++;
                } else if (line.startsWith('Question:')) {
                    hasQuestions = true;
                    questionCount++;
                } else if (line.match(/^[A-D]\./)) {
                    hasOptions = true;
                } else if (line.startsWith('CorrectAnswers:')) {
                    hasCorrectAnswers = true;
                }
            }

            // Vérifications spécifiques
            if (!hasPages) {
                validationErrors.push('Aucune page détectée (format: "Page: 1")');
            }
            if (!hasQuestions) {
                validationErrors.push('Aucune question détectée (format: "Question: 1")');
            }
            if (!hasOptions) {
                validationErrors.push('Aucune option de réponse détectée (format: "A. Option")');
            }
            if (!hasCorrectAnswers) {
                validationErrors.push('Aucune réponse correcte détectée (format: "CorrectAnswers: A")');
            }

            // Affichage du statut de validation
            const validationStatus = document.getElementById('validationStatus');
            const validationInfo = validationStatus.querySelector('.validation-info');
            const validationSummary = validationStatus.querySelector('.validation-summary');

            if (validationErrors.length === 0) {
                // Tout est OK
                validationInfo.innerHTML = `
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Format du texte validé</span>
                    </div>
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Structure des questions détectée</span>
                    </div>
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Options de réponse identifiées</span>
                    </div>
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Réponses correctes trouvées</span>
                    </div>
                    <div class="validation-item">
                        <i class="fas fa-check text-success"></i>
                        <span>Prêt pour la conversion</span>
                    </div>
                `;
                validationSummary.innerHTML = `<p class="text-success"><strong>Tout est OK !</strong> Votre texte est prêt à être converti en JSON.</p>
                <p class="text-info mt-2 mb-0"><strong>Détection :</strong> ${pageCount} page${pageCount > 1 ? 's' : ''} et ${questionCount} question${questionCount > 1 ? 's' : ''} détectées.</p>`;
                validationStatus.style.display = 'block';
            } else {
                // Il y a des erreurs
                validationInfo.innerHTML = validationErrors.map(error => `
                    <div class="validation-item">
                        <i class="fas fa-times text-danger"></i>
                        <span>${error}</span>
                    </div>
                `).join('');
                let summaryText = '<p class="text-danger"><strong>Attention !</strong> Veuillez corriger les erreurs avant la conversion.</p>';
                if (pageCount > 0 || questionCount > 0) {
                    summaryText += `<p class="text-info mt-2 mb-0"><strong>Détection partielle :</strong> ${pageCount} page${pageCount > 1 ? 's' : ''} et ${questionCount} question${questionCount > 1 ? 's' : ''} détectées.</p>`;
                }
                validationSummary.innerHTML = summaryText;
                validationStatus.style.display = 'block';
            }
        }

        // Affichage de la section de configuration
        function showConfigSection() {
            document.getElementById('configSection').style.display = 'block';
        }

        // Affichage des boutons d'action
        function showActionButtons() {
            document.getElementById('actionButtons').style.display = 'block';
        }

        // Conversion en JSON
        function convertToJSON() {
            const startTime = performance.now();
            
            try {
                const qcmTitle = document.getElementById('qcmTitle').value.trim();
                if (!qcmTitle) {
                    showNotification('Veuillez saisir un titre pour le QCM.', 'error');
                    return;
                }

                const qcmDescription = document.getElementById('qcmDescription').value.trim();
                const qcmIcon = document.getElementById('qcmIcon').value;
                const qcmDifficulty = document.getElementById('qcmDifficulty').value;
                const qcmPassingThreshold = parseInt(document.getElementById('qcmPassingThreshold').value) || 70;

                // Parsing du texte
                const lines = originalText.split('\n').map(line => line.trim()).filter(line => line);
                const qcm = {
                    id: generateId(),
                    title: qcmTitle,
                    description: qcmDescription,
                    iconClass: qcmIcon,
                    difficultyLevel: qcmDifficulty,
                    passingThreshold: qcmPassingThreshold,
                    status: 'draft',
                    isFavorite: false,
                    pages: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                let currentPage = null;
                let currentQuestion = null;
                let pageNumber = 1;
                let questionCounter = 1;

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    if (line.startsWith('Page:')) {
                        // Nouvelle page
                        if (currentPage && currentQuestion) {
                            currentPage.questions.push(currentQuestion);
                        }
                        if (currentPage) {
                            qcm.pages.push(currentPage);
                        }
                        
                        pageNumber = parseInt(line.split(':')[1].trim()) || pageNumber;
                        currentPage = {
                            id: `page_${pageNumber}`,
                            name: `Page ${pageNumber}`,
                            questions: []
                        };
                        currentQuestion = null;
                    } else if (line.startsWith('Question:')) {
                        // Nouvelle question
                        if (currentPage && currentQuestion) {
                            currentPage.questions.push(currentQuestion);
                        }
                        
                        const questionId = parseInt(line.split(':')[1].trim()) || questionCounter;
                        currentQuestion = {
                            id: questionId.toString(),
                            text: '',
                            options: [],
                            correctAnswers: [],
                            explanation: ''
                        };
                        questionCounter++;
                    } else if (line.match(/^[A-D]\./)) {
                        // Option de réponse
                        if (currentQuestion) {
                            const letter = line.charAt(0);
                            const optionText = line.substring(2).trim();
                            currentQuestion.options.push({
                                id: letter.toLowerCase(),
                                letter: letter,
                                text: optionText
                            });
                        }
                    } else if (line.startsWith('CorrectAnswers:')) {
                        // Réponses correctes
                        if (currentQuestion) {
                            const answers = line.split(':')[1].trim();
                            currentQuestion.correctAnswers = answers.split(',').map(a => a.trim());
                            // Déterminer le type de question basé sur le nombre de réponses correctes
                            currentQuestion.type = currentQuestion.correctAnswers.length > 1 ? 'multiple' : 'single';
                        }
                    } else if (line.startsWith('Explanation:')) {
                        // Explication
                        if (currentQuestion) {
                            currentQuestion.explanation = line.split(':')[1].trim();
                        }
                    } else if (currentQuestion && line && !line.startsWith('Page:') && !line.startsWith('Question:') && !line.startsWith('CorrectAnswers:') && !line.startsWith('Explanation:')) {
                        // Texte de la question
                        if (currentQuestion.text) {
                            currentQuestion.text += ' ' + line;
                        } else {
                            currentQuestion.text = line;
                        }
                    }
                }

                // Ajouter la dernière question et page
                if (currentPage && currentQuestion) {
                    currentPage.questions.push(currentQuestion);
                }
                if (currentPage) {
                    qcm.pages.push(currentPage);
                }

                // Calcul des statistiques
                const totalPages = qcm.pages.length;
                const totalQuestions = qcm.pages.reduce((sum, page) => sum + page.questions.length, 0);
                const totalOptions = qcm.pages.reduce((sum, page) => 
                    sum + page.questions.reduce((qSum, q) => qSum + q.options.length, 0), 0);
                const conversionTime = ((performance.now() - startTime) / 1000).toFixed(2);

                // Mise à jour des statistiques
                document.getElementById('totalPages').textContent = totalPages;
                document.getElementById('totalQuestions').textContent = totalQuestions;
                document.getElementById('totalOptions').textContent = totalOptions;
                document.getElementById('conversionTime').textContent = conversionTime + 's';

                // Affichage des statistiques et aperçu
                document.getElementById('statsSection').style.display = 'block';
                document.getElementById('jsonPreview').style.display = 'block';
                document.getElementById('jsonOutput').textContent = JSON.stringify(qcm, null, 2);

                // Affichage des boutons de téléchargement et import
                document.getElementById('downloadBtn').style.display = 'inline-block';
                document.getElementById('importBtn').style.display = 'inline-block';

                convertedData = qcm;
                showNotification('Conversion réussie !', 'success');

            } catch (error) {
                console.error('Erreur lors de la conversion:', error);
                showNotification('Erreur lors de la conversion. Vérifiez le format du fichier.', 'error');
            }
        }

        // Téléchargement du JSON
        function downloadJSON() {
            if (!convertedData) {
                showNotification('Aucune donnée à télécharger.', 'error');
                return;
            }

            const blob = new Blob([JSON.stringify(convertedData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${convertedData.title.replace(/[^a-zA-Z0-9]/g, '_')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Fichier JSON téléchargé avec succès !', 'success');
        }

        // Import dans mcqED
        function importToMCQED() {
            if (!convertedData) {
                showNotification('Aucune donnée à importer.', 'error');
                return;
            }

            try {
                // Récupération des QCMs existants
                const existingQCMs = JSON.parse(localStorage.getItem('mcqed_qcms') || '[]');
                
                // Vérification si le QCM existe déjà
                const existingIndex = existingQCMs.findIndex(qcm => qcm.title === convertedData.title);
                if (existingIndex !== -1) {
                    if (confirm('Un QCM avec ce titre existe déjà. Voulez-vous le remplacer ?')) {
                        existingQCMs[existingIndex] = convertedData;
                    } else {
                        return;
                    }
                } else {
                    existingQCMs.push(convertedData);
                }

                // Sauvegarde
                localStorage.setItem('mcqed_qcms', JSON.stringify(existingQCMs));
                
                showNotification('QCM importé avec succès dans mcqED !', 'success');
                
                // Redirection vers l'éditeur après 2 secondes
                setTimeout(() => {
                    window.location.href = 'question-editor.html';
                }, 2000);

            } catch (error) {
                console.error('Erreur lors de l\'import:', error);
                showNotification('Erreur lors de l\'import dans mcqED.', 'error');
            }
        }

        // Réinitialisation du convertisseur
        function resetConverter() {
            convertedData = null;
            originalText = '';
            
            // Réinitialisation des champs
            document.getElementById('qcmTitle').value = '';
            document.getElementById('qcmDescription').value = '';
            document.getElementById('qcmIcon').value = 'fas fa-question';
            document.getElementById('qcmDifficulty').value = 'beginner';
            document.getElementById('qcmPassingThreshold').value = '70';
            document.getElementById('txtFile').value = '';
            document.getElementById('directTextInput').value = '';
            
            // Masquage des sections
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('validationStatus').style.display = 'none';
            document.getElementById('configSection').style.display = 'none';
            document.getElementById('statsSection').style.display = 'none';
            document.getElementById('jsonPreview').style.display = 'none';
            document.getElementById('actionButtons').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'none';
            document.getElementById('importBtn').style.display = 'none';
            
            showNotification('Convertisseur réinitialisé.', 'warning');
        }

        // Génération d'ID unique
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Affichage des notifications
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkSession()) {
                window.location.href = 'login.html';
                return;
            }
            
            updateUserDisplay();
            initTheme();
            setupDragAndDrop();
            
            // Mettre à jour l'état initial du bouton mode sombre
            const darkModeLink = document.querySelector('.nav-link[onclick="toggleDarkMode()"]');
            if (darkModeLink) {
                const icon = darkModeLink.querySelector('i');
                const span = darkModeLink.querySelector('span');
                
                // Récupérer le thème depuis localStorage ou utiliser 'light' par défaut
                const savedTheme = localStorage.getItem('mcqed_theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                if (savedTheme === 'dark') {
                    icon.className = 'fas fa-sun';
                    span.textContent = 'Mode clair';
                } else {
                    icon.className = 'fas fa-moon';
                    span.textContent = 'Mode sombre';
                }
            }
            
            // Mettre à jour l'état initial du bouton mode daltonien
            const colorblindLink = document.querySelector('.nav-link[onclick="toggleColorblindMode()"]');
            if (colorblindLink) {
                const icon = colorblindLink.querySelector('i');
                const span = colorblindLink.querySelector('span');
                
                // Récupérer le mode daltonien depuis localStorage ou utiliser 'disabled' par défaut
                const savedColorblindMode = localStorage.getItem('mcqed_colorblind') || 'disabled';
                document.documentElement.setAttribute('data-colorblind', savedColorblindMode);
                
                if (savedColorblindMode === 'enabled') {
                    icon.className = 'fas fa-eye-slash';
                    span.textContent = 'Mode normal';
                } else {
                    icon.className = 'fas fa-eye';
                    span.textContent = 'Mode daltonien';
                }
            }
        });

        // Vérification de session
        function checkSession() {
            const sessionData = sessionStorage.getItem('mcqed_session');
            if (!sessionData) {
                return false;
            }

            try {
                const session = JSON.parse(sessionData);
                const now = Date.now();
                
                if (session.expiresAt <= now) {
                    sessionStorage.removeItem('mcqed_session');
                    return false;
                }
                
                return true;
            } catch (e) {
                sessionStorage.removeItem('mcqed_session');
                return false;
            }
        }

        // Mise à jour de l'affichage utilisateur
        function updateUserDisplay() {
            const sessionData = JSON.parse(sessionStorage.getItem('mcqed_session'));
            document.getElementById('username-display').textContent = sessionData.userId;
        }

        // Déconnexion
        function logout() {
            if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                sessionStorage.removeItem('mcqed_session');
                window.location.href = 'login.html';
            }
        }
        
        // Fonction pour basculer le mode sombre
        function toggleDarkMode() {
            const darkModeLink = document.querySelector('.nav-link[onclick="toggleDarkMode()"]');
            const icon = darkModeLink.querySelector('i');
            const span = darkModeLink.querySelector('span');
            
            // Basculer le mode sombre en utilisant la fonction de dark-mode.js
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // Appliquer le nouveau thème
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('mcqed_theme', newTheme);
            
            // Mettre à jour l'icône et le texte
            if (newTheme === 'dark') {
                icon.className = 'fas fa-sun';
                span.textContent = 'Mode clair';
            } else {
                icon.className = 'fas fa-moon';
                span.textContent = 'Mode sombre';
            }
        }
        
        // Fonction pour basculer le mode daltonien
        function toggleColorblindMode() {
            const colorblindLink = document.querySelector('.nav-link[onclick="toggleColorblindMode()"]');
            const icon = colorblindLink.querySelector('i');
            const span = colorblindLink.querySelector('span');
            
            // Basculer le mode daltonien
            const currentColorblindMode = document.documentElement.getAttribute('data-colorblind');
            const newColorblindMode = currentColorblindMode === 'enabled' ? 'disabled' : 'enabled';
            
            // Appliquer le mode daltonien
            document.documentElement.setAttribute('data-colorblind', newColorblindMode);
            localStorage.setItem('mcqed_colorblind', newColorblindMode);
            
            // Mettre à jour l'icône et le texte
            if (newColorblindMode === 'enabled') {
                icon.className = 'fas fa-eye-slash';
                span.textContent = 'Mode normal';
            } else {
                icon.className = 'fas fa-eye';
                span.textContent = 'Mode daltonien';
            }
        }
        
        // Fonction pour basculer le sous-menu Mon compte
        function toggleSubmenu(element) {
            const navItem = element.closest('.nav-item');
            const isOpen = navItem.classList.contains('open');
            
            // Fermer tous les autres sous-menus
            document.querySelectorAll('.nav-item.has-submenu').forEach(item => {
                item.classList.remove('open');
            });
            
            // Basculer l'état du sous-menu actuel
            if (!isOpen) {
                navItem.classList.add('open');
            }
        }
    </script>
    <script src="dark-mode.js"></script>
</body>
</html> 